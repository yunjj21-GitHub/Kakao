// 2018 KAKAO BLIND RECRUITMENT : 다트 게임
#include <string>
#include <vector>

using namespace std;

int solution(string dartResult) {
    int answer = 0;

    int idx = 0;
    vector<int> result; // 각 기회의 점수를 저장
    while (idx < dartResult.size()) {
        // 점수 처리
        string str_num;
        str_num += dartResult[idx];
        if ('0' <= dartResult[idx + 1] && dartResult[idx + 1] <= '9') { // 점수가 10일 때
            str_num += dartResult[idx + 1];
            idx++;
        }
        idx++;
        int num = stoi(str_num);

        // 보너스 처리
        if (dartResult[idx] == 'S') {
            num = num;
        }
        else if (dartResult[idx] == 'D') {
            num = num * num;
        }
        else if (dartResult[idx] == 'T') {
            num = num * num * num;
        }
        idx++;

        // 옵션 처리
        if (idx < dartResult.size() && dartResult[idx] == '*') {
            num = 2 * num;
            if (result.size() >= 1) {
                int preNum = result.back();
                result.pop_back();
                preNum = 2 * preNum;
                result.push_back(preNum);
            }
            idx++;
        }
        else if (idx < dartResult.size() && dartResult[idx] == '#') {
            num = -1 * num;
            idx++;
        }

        result.push_back(num);
    }

    // 각 기회에서 얻은 점수의 합을 구함
    for (int res : result) {
        answer += res;
    }

    return answer;
}